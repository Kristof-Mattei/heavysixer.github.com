
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Getting Closure - Mark Daggett's Blog</title>
  <meta name="author" content="Mark Daggett">

  
  <meta name="description" content="Understanding the Dark Arts of JavaScript Closures &quot;No matter where you go, there you are.&quot;
- Buckaroo Banzai
The purpose of this post is &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://heavysixer.github.com/blog/2013/02/25/getting-closure">
  <link href="/favicon.ico" rel="icon">
  
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Mark Daggett's Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1950734-4']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="no-sidebar"  >
  <header role="banner"><hgroup>
  <h1>Mark Daggett's Blog</h1>
  
    <h2><a href="/">Innovator & Bricoleur</a></h2>
  
</hgroup>

</header>
  <nav role="navigation">
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:heavysixer.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><small><a href="https://github.com/heavysixer">Github</a></small></li>
  <li><small><a href="https://twitter.com/heavysixer">@heavysixer</a></small></li>
  <li><small><a href="http://www.amazon.com/Mark-E.-Daggett/e/B00EXUMLSC">My Books</a></small></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Getting Closure</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-25T15:21:00-06:00" pubdate data-updated="true">Feb 25<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><div class="section" id="understanding-the-dark-arts-of-javascript-closures">
<h2>Understanding the Dark Arts of JavaScript Closures</h2>
<blockquote>
&quot;No matter where you go, there you are.&quot;
- Buckaroo Banzai</blockquote>
<p>The purpose of this post is to explain how closures work in plain english, and to give a few compelling examples where the use of closures really improve
the quality of your code.</p>
<p>Like many others I am a self-taught programmer, and little over a decade ago I was also a freshly minted Creative Director working in Los Angels. I was employed
by a major footwear brand, and had inherited a team of very bright and technically gifted programmers. I felt that I needed to learn enough code to speak
intelligently to them. I didn&#8217;t want to propose a feature that wasn&#8217;t possible, and more importantly I wanted to understand the promise and the problems
inherent in the medium we were building within. More generally though, I am just a very curious person who likes to learn. Once I started to pull that tread
the world of programming began to unwind for me. Now years later, here I sit writing about the internals of JavaScript.</p>
<p>Being that my computer science education has been ad-hoc there are many core concepts in JavaScript (and programming in general) that I wanted to understand
better. My hypothesis is that there are others like me who have been using and abusing JavaScript for years. For this reason I decided to write on closures an
often used but equally often misunderstood concept in JavaScript. Closures are important for a variety of reasons:</p>
<ol class="arabic simple">
<li>They are both a feature and a philosophy that once understood makes many other concepts (e.g. data binding, promise objects) in JavaScript easier.</li>
<li>They are one of the most powerful internals of the language, which many other so-called <em>real</em> languages don&#8217;t support.</li>
<li>They are where JavaScript is trending due to the rise in popularity of asynchronous execution.</li>
</ol>
<p>For all the potential benefits that closures offer, there is a <em>black magic</em> quality to them that can make them hard to understand. Let&#8217;s start with a
definition, <strong>A closure is the act of binding all free variables, and functions into a closed expression, that persist beyond the lexical scope from which they
were created.</strong> While this is a succinct definition it is pretty impenetrable for the uninitiated; let&#8217;s dig deeper.</p>
</div>
<div class="section" id="the-straight-dope-on-scope">
<h2>The Straight Dope On Scope</h2>
<p>Before we can truly understand closures we must take a step back and look at how scope works in JavaScript. When reading about JavaScript periodically
writers will make reference to lexical scope, or the current and/or executing scope. Lexical scope simply means that where a statement is placed within the
body of the script is important and effects how it can be accessed, and what in turn it has access to. In JavaScript unlike other languages the only way to
create a new scope is through a function invocation <a class="footnote-reference" href="#id8" id="id1">[1]</a>. This is what programmers mean when they say JavaScript has function level scoping. This form of
scoping may be anti-intuitive to programmers coming from languages that support block-level scoping e.g. Ruby.</p>
<p>The following example demonstrates lexical scope:</p>
<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="c1">// Free Variable</span>
</span><span class="line"><span class="kd">var</span> <span class="nx">iAmFree</span> <span class="o">=</span> <span class="s1">&#39;Free to be me!&#39;</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="kd">function</span> <span class="nx">canHazAccess</span><span class="p">(</span><span class="nx">notFree</span><span class="p">){</span>
</span><span class="line">
</span><span class="line">  <span class="kd">var</span> <span class="nx">notSoFree</span> <span class="o">=</span> <span class="s2">&quot;i am bound to this scope&quot;</span><span class="p">;</span>
</span><span class="line">
</span><span class="line">  <span class="c1">// =&gt; &quot;Free to be me!&quot;</span>
</span><span class="line">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">iAmFree</span><span class="p">);</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="c1">// =&gt; ReferenceError: notSoFree is not defined</span>
</span><span class="line"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">notSoFree</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="nx">canHazAccess</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure><p>As you can see the function declaration <em>canHazAccess()</em> can reference the <em>iAmFree</em> variable; this is because the variable belongs to the enclosing scope. The
<em>iAmFree</em> variable is an example of what in JavaScript is called a <strong>free variable</strong> <a class="footnote-reference" href="#id9" id="id2">[2]</a>. Free variables are any non-local variable which the function
body has access to. To qualify as a free variable it must be defined outside the function body and not be passed as a function argument.</p>
<p>Conversely, we see that referencing <em>notSoFree</em> from the enclosing scope produces an error. This is because at the point at which this variable
was defined it was inside a new lexical scope (remember function invocation creates a new scope).</p>
<p>Put another way, <strong>function level scopes act like one-way mirrors; they let elements inside the function body spy on variables in the outer scope, while they
remain hidden.</strong> As we&#8217;ll see below closures short-circuit this relationship, and provide a mechanism whereby the inner scopes internals can
be accessed by the outer scope.</p>
</div>
<div class="section" id="thisunderstandings">
<h2>Thisunderstandings</h2>
<p>One feature of scopes, that routinely throw developers off (even seasoned ones) is the use of the <em>this</em> keyword as it pertains to the lexical
scope. In JavaScript the <strong>this keyword always refers to the owner of scope from which it is executing</strong>. Misunderstanding how <em>this</em> works can
cause all sorts of weird errors where a developer assumes they are accessing a particular scope but are actually using another. Here is how this might
happen:</p>
<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">var</span> <span class="nx">Car</span><span class="p">,</span> <span class="nx">tesla</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="nx">Car</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">  <span class="k">this</span><span class="p">.</span><span class="nx">start</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;car started&quot;</span><span class="p">);</span>
</span><span class="line">  <span class="p">};</span>
</span><span class="line">
</span><span class="line">  <span class="k">this</span><span class="p">.</span><span class="nx">turnKey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="kd">var</span> <span class="nx">carKey</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;car_key&#39;</span><span class="p">);</span>
</span><span class="line">    <span class="nx">carKey</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">      <span class="k">this</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
</span><span class="line">    <span class="p">};</span>
</span><span class="line">  <span class="p">};</span>
</span><span class="line">  <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
</span><span class="line"><span class="p">};</span>
</span><span class="line"><span class="nx">tesla</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Car</span><span class="p">();</span>
</span><span class="line">
</span><span class="line"><span class="c1">// Once a user click&#39;s the #carKey element they will see &quot;Uncaught TypeError: Object  has no method &#39;start&#39;&quot;</span>
</span><span class="line"><span class="nx">tesla</span><span class="p">.</span><span class="nx">turnKey</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure><p>The developer who wrote this was headed in the right direction, but ultimately a <em>thisunderstanding</em> forced them off the rails. They correctly bound
the click event to the <em>car_key</em> DOM element. However, they assumed that nesting the click binding inside the car class would give the DOM element a reference
to the car&#8217;s <em>this</em> context. The approach is intuitive and <em>looks legit</em>, especially based on what we know about free variables and lexical scope. Unfortunately,
it&#8217;s hopelessly borked; because as we learned earlier a new scope is created each time a function is invoked. Once the onclick event fired <em>this</em> now
referred to the DOM element not the car class.</p>
<p>Developers sometimes get around this scoping confusion by assigning <em>this</em> to a local free variable (e.g. that, _this, self, me). Here is the previous method
rewritten to use a local free variable instead of <em>this</em>.</p>
<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">var</span> <span class="nx">Car</span><span class="p">,</span> <span class="nx">tesla</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="nx">Car</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">  <span class="k">this</span><span class="p">.</span><span class="nx">start</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;car started&quot;</span><span class="p">);</span>
</span><span class="line">  <span class="p">};</span>
</span><span class="line">
</span><span class="line">  <span class="k">this</span><span class="p">.</span><span class="nx">turnKey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span><span class="line">    <span class="kd">var</span> <span class="nx">carKey</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;carKey&#39;</span><span class="p">);</span>
</span><span class="line">    <span class="nx">carKey</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">      <span class="nx">that</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
</span><span class="line">    <span class="p">};</span>
</span><span class="line">  <span class="p">};</span>
</span><span class="line">  <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
</span><span class="line"><span class="p">};</span>
</span><span class="line"><span class="nx">tesla</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Car</span><span class="p">();</span>
</span><span class="line">
</span><span class="line"><span class="c1">// Once a user click&#39;s the #carKey element they will see &quot;car started&quot;</span>
</span><span class="line"><span class="nx">tesla</span><span class="p">.</span><span class="nx">turnKey</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure><p>Because <em>that</em> is a free variable, it won&#8217;t be redefined when the onclick event is triggered. Instead it remains as a pointer to the previous <em>this</em> context.
Technically, this solves the problem, and I am going to resist the urge of calling this an anti-pattern (for now). I have used this technique thousands of
times over the years. However, it always <em>felt</em> like a hack, and fortunately, closures can help us marshall scopes in a much more elegant way.</p>
</div>
<div class="section" id="my-first-closure">
<h2>My First Closure</h2>
<p>In it&#8217;s most basic form a closure is simply an outer function that returns an inner function. Doing this creates a mechanism to return an enclosed scope on
demand. Here is a simple closure:</p>
<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">function</span> <span class="nx">outer</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">  <span class="kd">var</span> <span class="nx">hello</span> <span class="o">=</span> <span class="s2">&quot;hi&quot;</span><span class="p">,</span>
</span><span class="line">  <span class="nx">inner</span><span class="p">;</span>
</span><span class="line">
</span><span class="line">  <span class="k">return</span> <span class="nx">inner</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="nx">hello</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">;</span>
</span><span class="line">  <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="c1">// Create and use the closure</span>
</span><span class="line"><span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">outer</span><span class="p">(</span><span class="s2">&quot;mark&quot;</span><span class="p">)();</span>
</span><span class="line">
</span><span class="line"><span class="c1">// =&gt; &#39;hi mark&#39;</span>
</span><span class="line"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure><p>In this example you can see that the local variable <em>hello</em> can be used in the return statement of the inner function. At the point of execution <em>hello</em> is a
free variable belonging to the enclosing scope. This example borders on meaninglessness though; lets look at a slightly more complex closure:</p>
<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">var</span> <span class="nx">car</span><span class="p">;</span>
</span><span class="line"><span class="kd">function</span> <span class="nx">carFactory</span><span class="p">(</span><span class="nx">kind</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">  <span class="kd">var</span> <span class="nx">wheelCount</span><span class="p">,</span> <span class="nx">start</span><span class="p">;</span>
</span><span class="line">  <span class="nx">wheelCount</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span><span class="line">  <span class="nx">start</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;started with &#39;</span> <span class="o">+</span> <span class="nx">wheelCount</span> <span class="o">+</span> <span class="s1">&#39; wheels.&#39;</span><span class="p">);</span>
</span><span class="line">  <span class="p">};</span>
</span><span class="line">
</span><span class="line">  <span class="c1">// Closure created here.</span>
</span><span class="line">  <span class="k">return</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="p">{</span>
</span><span class="line">      <span class="nx">make</span><span class="o">:</span> <span class="nx">kind</span><span class="p">,</span>
</span><span class="line">      <span class="nx">wheels</span><span class="o">:</span> <span class="nx">wheelCount</span><span class="p">,</span>
</span><span class="line">      <span class="nx">startEngine</span><span class="o">:</span> <span class="nx">start</span>
</span><span class="line">    <span class="p">};</span>
</span><span class="line">  <span class="p">}());</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="nx">car</span> <span class="o">=</span> <span class="nx">carFactory</span><span class="p">(</span><span class="s1">&#39;Tesla&#39;</span><span class="p">);</span>
</span><span class="line">
</span><span class="line"><span class="c1">// =&gt; Tesla</span>
</span><span class="line"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">car</span><span class="p">.</span><span class="nx">make</span><span class="p">);</span>
</span><span class="line">
</span><span class="line"><span class="c1">// =&gt; started with 4 wheels.</span>
</span><span class="line"><span class="nx">car</span><span class="p">.</span><span class="nx">startEngine</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure></div>
<div class="section" id="why-use-closures">
<h2>Why Use Closures</h2>
<p>Now that we know what closures are, let&#8217;s look at some use cases on where they can elegantly solve common problems in JavaScript.</p>
<ul>
<li><p class="first"><strong>Object Factories</strong></p>
<p>The previous closure implements what is commonly known as the Factory Pattern <a class="footnote-reference" href="#id10" id="id3">[3]</a>. In keeping with a Factory Pattern the internals of the factory can be
quite complex but are abstracted away in part thanks to the closure. This highlights one of the best features of closures which is their ability to
hide state. JavaScript doesn&#8217;t have the concept of private or protected contexts, but using closures give us a good way to emulate some level of privacy.</p>
</li>
<li><p class="first"><strong>Create A Binding Proxy</strong></p>
<p>As promised lets revisit the Car class we wrote earlier. We solved the scoping problem by assigning the outer function&#8217;s <em>this</em> reference to a <em>that</em> free
variable. Instead of that approach we&#8217;ll solve it through the use of closures. First we create a reusable closure function called <em>proxy</em>, which takes
a function and a context and returns a new function with the supplied context applied. Then we wrap the onclick function with our <em>proxy</em> and pass in the <em>this</em>
that references the current instance of the <em>Car</em> class. Coincidentally, this is a simplified version of what jQuery does in their own proxy function <a class="footnote-reference" href="#id11" id="id4">[4]</a>.</p>
<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">var</span> <span class="nx">Car</span><span class="p">,</span> <span class="nx">proxy</span><span class="p">,</span> <span class="nx">tesla</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="nx">Car</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">  <span class="k">this</span><span class="p">.</span><span class="nx">start</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;car started&quot;</span><span class="p">);</span>
</span><span class="line">  <span class="p">};</span>
</span><span class="line">  <span class="k">this</span><span class="p">.</span><span class="nx">turnKey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="kd">var</span> <span class="nx">carKey</span><span class="p">;</span>
</span><span class="line">    <span class="nx">carKey</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;carKey&quot;</span><span class="p">);</span>
</span><span class="line">    <span class="nx">carKey</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="nx">proxy</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">      <span class="k">this</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
</span><span class="line">    <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
</span><span class="line">  <span class="p">};</span>
</span><span class="line">  <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
</span><span class="line"><span class="p">};</span>
</span><span class="line">
</span><span class="line"><span class="c1">// Use a closure to bind the outer scope&#39;s reference to this into the newly created inner scope.</span>
</span><span class="line"><span class="nx">proxy</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">self</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">  <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
</span><span class="line">  <span class="p">};</span>
</span><span class="line"><span class="p">};</span>
</span><span class="line">
</span><span class="line"><span class="nx">tesla</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Car</span><span class="p">();</span>
</span><span class="line">
</span><span class="line"><span class="c1">// Once a user click&#39;s the #carKey element they will see &quot;car started&quot;</span>
</span><span class="line"><span class="nx">tesla</span><span class="p">.</span><span class="nx">turnKey</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure></li>
<li><p class="first"><strong>Contextually Aware DOM Manipulation</strong></p>
<p>This example comes from directly from Juriy Zaytsev&#8217;s excellent article &quot;Use Cases for JavaScript Closures&quot; <a class="footnote-reference" href="#id12" id="id5">[5]</a> . His example code demonstrates how to use a
closure to ensure a DOM element has a unique ID. The larger takeaway is that you can use closures as a way to maintain internal states about your program in
an encapsulated manner.</p>
<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">var</span> <span class="nx">getUniqueId</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">  <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class="line">  <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">element</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">      <span class="nx">element</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s1">&#39;generated-uid-&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="o">++</span><span class="p">;</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">    <span class="k">return</span> <span class="nx">element</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</span><span class="line">  <span class="p">};</span>
</span><span class="line"><span class="p">})();</span>
</span><span class="line">
</span><span class="line"><span class="kd">var</span> <span class="nx">elementWithId</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">);</span>
</span><span class="line"><span class="nx">elementWithId</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s1">&#39;foo-bar&#39;</span><span class="p">;</span>
</span><span class="line"><span class="kd">var</span> <span class="nx">elementWithoutId</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">);</span>
</span><span class="line">
</span><span class="line"><span class="c1">// =&gt; &#39;foo-bar&#39;</span>
</span><span class="line"><span class="nx">getUniqueId</span><span class="p">(</span><span class="nx">elementWithId</span><span class="p">);</span>
</span><span class="line">
</span><span class="line"><span class="c1">// =&gt; &#39;generated-id-0&#39;</span>
</span><span class="line"><span class="nx">getUniqueId</span><span class="p">(</span><span class="nx">elementWithoutId</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></li>
<li><p class="first"><strong>Singleton Module Pattern</strong></p>
<p>Modules are used to encapsulate and organize related code together under one roof. Using modules keeps your codebase cleaner, easier to test, and reuse.
Attribution for the Module Pattern is typically given to Richard Conford <a class="footnote-reference" href="#id13" id="id6">[6]</a>, though a number of people most notably Douglas Crockford are responsible for
popularizing it. The Singleton Module is a flavor that restricts more than one instance of the object from existing. It is very useful for instances where
you want several objects to share a resource. A much more in depth example of the Singleton Module can be found here <a class="footnote-reference" href="#id14" id="id7">[7]</a>, but for now consider the following
example:</p>
<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="c1">// Create a closure</span>
</span><span class="line"><span class="kd">var</span> <span class="nx">SecretStore</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">  <span class="kd">var</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">secret</span><span class="p">,</span> <span class="nx">newSecret</span><span class="p">;</span>
</span><span class="line">
</span><span class="line">  <span class="c1">// Emulation of a private variables and functions</span>
</span><span class="line">  <span class="nx">data</span> <span class="o">=</span> <span class="s1">&#39;secret&#39;</span><span class="p">;</span>
</span><span class="line">  <span class="nx">secret</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="nx">data</span><span class="p">;</span>
</span><span class="line">  <span class="p">}</span>
</span><span class="line">  <span class="nx">newSecret</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">newValue</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">    <span class="nx">data</span> <span class="o">=</span> <span class="nx">newValue</span><span class="p">;</span>
</span><span class="line">    <span class="k">return</span> <span class="nx">secret</span><span class="p">();</span>
</span><span class="line">  <span class="p">}</span>
</span><span class="line">
</span><span class="line">  <span class="c1">// Return an object literal which is the only way to access the private functions and variables</span>
</span><span class="line">  <span class="k">return</span> <span class="p">{</span>
</span><span class="line">    <span class="nx">getSecret</span><span class="o">:</span> <span class="nx">secret</span><span class="p">,</span>
</span><span class="line">    <span class="nx">setSecret</span><span class="o">:</span> <span class="nx">newSecret</span><span class="p">,</span>
</span><span class="line">  <span class="p">};</span>
</span><span class="line"><span class="p">})();</span>
</span><span class="line">
</span><span class="line"><span class="kd">var</span> <span class="nx">secret</span> <span class="o">=</span> <span class="nx">SecretStore</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="c1">// =&gt; &quot;secret&quot;</span>
</span><span class="line"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">secret</span><span class="p">.</span><span class="nx">getSecret</span><span class="p">());</span>
</span><span class="line">
</span><span class="line"><span class="c1">// =&gt; &quot;foo&quot;</span>
</span><span class="line"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">secret</span><span class="p">.</span><span class="nx">setSecret</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">));</span>
</span><span class="line">
</span><span class="line"><span class="c1">// =&gt; &quot;foo&quot;</span>
</span><span class="line"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">secret</span><span class="p">.</span><span class="nx">getSecret</span><span class="p">());</span>
</span><span class="line">
</span><span class="line"><span class="kd">var</span> <span class="nx">secret2</span> <span class="o">=</span> <span class="nx">SecretStore</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="c1">// =&gt; &quot;foo&quot;</span>
</span><span class="line"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">secret2</span><span class="p">.</span><span class="nx">getSecret</span><span class="p">());</span>
</span></code></pre></td></tr></table></div></figure></li>
</ul>
</div>
<div class="section" id="tldr-takeaways">
<h2>TLDR Takeaways</h2>
<ol class="arabic simple">
<li><strong>Lexical scope gives importance to where code is located within the script body.</strong></li>
<li><strong>Free variables are any non-local variable which the function body has access to.</strong></li>
<li><strong>The only way for new scopes to be created in JavaScript is through function invocation.</strong></li>
<li><strong>The *this* keyword always refers to the owner of scope from which it is executing.</strong></li>
<li><strong>A closure allows a function to access variables outside of its lexical scope.</strong></li>
</ol>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="http://howtonode.org/what-is-this">http://howtonode.org/what-is-this</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id9" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><a class="reference external" href="http://en.wikipedia.org/wiki/Free_variable">http://en.wikipedia.org/wiki/Free_variable</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td><a class="reference external" href="http://en.wikipedia.org/wiki/Factory_method_pattern">http://en.wikipedia.org/wiki/Factory_method_pattern</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id11" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td><a class="reference external" href="https://github.com/jquery/jquery/blob/master/src/core.js#L685">https://github.com/jquery/jquery/blob/master/src/core.js#L685</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id12" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[5]</a></td><td><a class="reference external" href="http://msdn.microsoft.com/en-us/magazine/ff696765.aspx">http://msdn.microsoft.com/en-us/magazine/ff696765.aspx</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id13" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[6]</a></td><td><a class="reference external" href="http://groups.google.com/group/comp.lang.javascript/msg/9f58bd11bd67d937">http://groups.google.com/group/comp.lang.javascript/msg/9f58bd11bd67d937</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id14" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[7]</a></td><td><a class="reference external" href="http://www.addyosmani.com/resources/essentialjsdesignpatterns/book/#singletonpatternjavascript">http://www.addyosmani.com/resources/essentialjsdesignpatterns/book/#singletonpatternjavascript</a></td></tr>
</tbody>
</table>
</div>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn"><a href="/about" title="About the author (Mark Daggett)" rel="author">Mark Daggett</a></span></span>

      








  


<time datetime="2013-02-25T15:21:00-06:00" pubdate data-updated="true">Feb 25<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/javascript/'>JavaScript</a>, <a class='category' href='/blog/categories/relearning-javascript/'>Relearning JavaScript</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://heavysixer.github.com/blog/2013/02/25/getting-closure/" data-via="" data-counturl="http://heavysixer.github.com/blog/2013/02/25/getting-closure/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/02/21/cya-with-css/" title="Previous Post: CYA With CSS">&laquo; CYA With CSS</a>
      
      
        <a class="basic-alignment right" href="/blog/2013/02/27/javascript-parsetrees/" title="next Post: Javascript ParseTrees">Javascript ParseTrees &raquo;</a>
      
    </p>
  </footer>
</article>

<div class='clearfix'>
  <div class="pull-left">
    <a href="http://amzn.com/1430260971"><img src="http://ecx.images-amazon.com/images/I/518uBIK5fCL._SL160_PIsitb-sticker-arrow-dp,TopRight,12,-18_SH30_OU01_AA160_.jpg"/></a>
  </div>
  <div class="pull-left" style="width:500px;">
    <h3>If you liked this post you'll love <a href="http://amzn.com/1430260971">my book on JavaScript</a></h3>
    <p>
      <a href="http://amzn.com/1430260971">Expert JavaScript</a> is your definitive guide to understanding how and why JavaScript behaves the way it does. Master the inner workings of JavaScript by learning in detail how modern applications are made. In covering lesser-understood aspects of this powerful language and truly understanding how it works, your JavaScript code and programming skills will improve.
    </p>
  </div>
</div>


  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Mark Daggett -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'markdaggettcom';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://heavysixer.github.com/blog/2013/02/25/getting-closure/';
        var disqus_url = 'http://heavysixer.github.com/blog/2013/02/25/getting-closure/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
